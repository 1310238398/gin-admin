(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{Vk26:function(e,t,i){"use strict";var n=i("g09b"),a=i("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("2qtc");var l,s,o,d=n(i("kLXV")),c=n(i("2Taf")),r=n(i("vZ4D")),u=n(i("l4Ni")),f=n(i("ujKo")),h=n(i("MhPg")),p=a(i("q1tI")),m=i("MuoO"),g=n(i("3a4m")),A=i("q78w"),b=i("+n12"),y=n(i("s1sE")),v=a(i("PBgL")),B=n(i("ygdr")),w=(l=(0,m.connect)(function(e){return{building:e.building}}),l((o=function(e){function t(e){var i;return(0,c.default)(this,t),i=(0,u.default)(this,(0,f.default)(t).call(this,e)),i.AllBuilding=[],i.handleBuilding=function(e){for(var t=[],n=0;n<e.length;n+=1){var a=e[n];a.flag_type=(0,b.parseBuildingStatus)(a),a.flag_type_text=(0,b.parseBuildingStatusText)(a),t.push(a)}i.AllBuilding=t,i.flagsSetting()},i.handleModalCancel=function(){i.setState({chartVisible:!1})},i.handleSiderClick=function(){var e=i.state.chartVisible;i.setState({chartVisible:!e})},i.handleAreaOpenButtonClick=function(){var e=i.state.areaVisible;i.setState({areaVisible:!e})},i.handleAreaButtonClick=function(e){var t=i.state.activeArea;t!==e&&(i.setState({activeArea:e}),i.flagsSetting(e))},i.handelBuildingClick=function(e){g.default.push("/building/floorframe/".concat(e))},i.handleTypeButtonClick=function(e){var t=i.state.activeType;t!==e&&(i.setState({activeType:e}),i.flagsSetting(void 0,e))},i.state={areaData:[],activeArea:"",activeType:0,areaVisible:!1,chartVisible:!1},i}return(0,h.default)(t,e),(0,r.default)(t,[{key:"componentDidMount",value:function(){this.B3D=new A.Building3D(this.mount,this.handelBuildingClick),this.getAllData()}},{key:"componentWillUnmount",value:function(){this.B3D&&this.B3D.Destory()}},{key:"getAllData",value:function(){var e=this;v.HouseQuery({q:"list",btype:90}).then(function(t){e.setState({areaData:t.list?t.list:[]})}),v.HouseQuery({q:"list",btype:80}).then(function(t){e.handleBuilding(t.list?t.list:[])})}},{key:"flagsSetting",value:function(e,t){var i=this.state,n=i.activeArea,a=i.activeType;void 0!==e&&(n=e),void 0!==t&&(a=t);for(var l=0;l<this.AllBuilding.length;l+=1)""!==n&&this.AllBuilding[l].parent_id!==n||0!==a&&this.AllBuilding[l].flag_type!==a?this.AllBuilding[l].select=!1:this.AllBuilding[l].select=!0;this.B3D.createAllSprite(this.AllBuilding)}},{key:"render",value:function(){var e=this,t=this.state,i=t.chartVisible,n=t.areaVisible,a=t.activeArea,l=t.activeType,s=t.areaData;return p.default.createElement("div",{className:B.default.main,ref:function(t){e.mount=t}},!i&&p.default.createElement("button",{type:"button",onClick:this.handleSiderClick,className:B.default.dataButton},p.default.createElement("i",null),"\u56ed\u533a\u6570\u636e"),i&&p.default.createElement(d.default,{destroyOnClose:!0,visible:i,className:B.default.darkModal,maskClosable:!1,closable:!0,width:"68%",centered:!0,maskStyle:{background:"transparent"},onCancel:function(){e.handleModalCancel()},footer:null},p.default.createElement(y.default,{show:i})),p.default.createElement("div",{className:B.default.typeBox},p.default.createElement("ul",null,p.default.createElement("li",{className:0===l?B.default.active:B.default.no,onClick:function(){e.handleTypeButtonClick(0)}},"\u5168\u90e8"),p.default.createElement("li",{className:20===l?B.default.active:B.default.no,onClick:function(){e.handleTypeButtonClick(20)}},p.default.createElement("i",{className:B.default["type-20"]})," \u5df2\u552e\u5b8c"),p.default.createElement("li",{className:21===l?B.default.active:B.default.no,onClick:function(){e.handleTypeButtonClick(21)}},p.default.createElement("i",{className:B.default["type-21"]})," \u5f85\u552e"),p.default.createElement("li",{className:30===l?B.default.active:B.default.no,onClick:function(){e.handleTypeButtonClick(30)}},p.default.createElement("i",{className:B.default["type-30"]})," \u5df2\u79df\u5b8c"),p.default.createElement("li",{className:31===l?B.default.active:B.default.no,onClick:function(){e.handleTypeButtonClick(31)}},p.default.createElement("i",{className:B.default["type-31"]})," \u5f85\u79df"),p.default.createElement("li",{className:40===l?B.default.active:B.default.no,onClick:function(){e.handleTypeButtonClick(40)}},p.default.createElement("i",{className:B.default["type-40"]})," \u79df\u552e\u5b8c\u6210"),p.default.createElement("li",{className:41===l?B.default.active:B.default.no,onClick:function(){e.handleTypeButtonClick(41)}},p.default.createElement("i",{className:B.default["type-41"]})," \u5f85\u79df\u5f85\u552e"),p.default.createElement("li",{className:42===l?B.default.active:B.default.no,onClick:function(){e.handleTypeButtonClick(42)}},p.default.createElement("i",{className:B.default["type-42"]})," \u79df\u552e\u4e2d"))),p.default.createElement("div",{className:B.default.areaBox,style:{right:n?"0":"-220px"}},p.default.createElement("button",{type:"button",onClick:this.handleAreaOpenButtonClick},p.default.createElement("i",{className:n?B.default.open:B.default.close})," \u533a\u57df"),p.default.createElement("dl",null,p.default.createElement("dt",{className:""===a?B.default.on:B.default.no,onClick:function(){return e.handleAreaButtonClick("")}},"\u5168\u90e8\u533a\u57df"),s&&s.length>0&&s.map(function(t){return p.default.createElement("dd",{onClick:function(){return e.handleAreaButtonClick(t.record_id)},className:a===t.record_id?B.default.on:B.default.no,key:t.record_id},p.default.createElement("i",{className:B.default.close}),t.code," ",t.name)}))))}}]),t}(p.PureComponent),s=o))||s),k=w;t.default=k},q78w:function(e,t,i){"use strict";var n=i("tAuX"),a=i("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.Building3D=void 0;var l=a(i("gWZ8")),s=a(i("2Taf")),o=a(i("vZ4D")),d=n(i("Womt")),c=i("RyHr"),r=i("5kJi"),u=i("QIYC"),f=i("DBIF"),h=i("IQkn"),p=function(){function e(t,i){var n,a,o=this;(0,s.default)(this,e),this.AllBuilding={},this.AllBuildingSelectType={},this.Buildings={},this.data={"A-0":{name:"LU",file:"LU"},"A1-1":{name:"A1-1",position:[-22500,14e3,-17500],file:"A14"},"A1-2":{name:"A1-2",position:[-23e3,12e3,-1e4],file:"A9"},"A1-3":{name:"A1-3",position:[-29500,15e3,-17500],file:"A11"},"A1-4":{name:"A1-4",position:[-29500,12e3,-10500],file:"A8"},"A1-5":{name:"A1-5",position:[-37500,17e3,-13e3],file:"A10"},"A2-1":{name:"A2-1",position:[-21500,12500,0],file:"A7"},"A2-2":{name:"A2-2",position:[-20500,11500,9500],file:"A12"},"A2-3":{name:"A2-3",position:[-27500,12e3,0],file:"A1"},"A2-4":{name:"A2-4",position:[-27500,11500,8700],file:"A6"},"A2-5":{name:"A2-5",position:[-36500,14e3,0],file:"A0"},"A2-6":{name:"A2-6",position:[-35500,12500,9e3],file:"A5"},"A3-1":{name:"A3-1",position:[-21500,12e3,18e3],file:"A13"},"A3-2":{name:"A3-2",position:[-20500,9e3,27e3],file:"A3"},"A3-3":{name:"A3-3",position:[-26500,11e3,27e3],file:"A15"},"A3-4":{name:"A3-4",position:[-35500,12e3,18e3],file:"A4"},"A3-5":{name:"A3-5",position:[-34e3,2e4,27e3],file:"A2"},"A4-1":{name:"A4-1",position:[12e3,12e3,-16e3],file:"A22"},"A4-2":{name:"A4-2",position:[6500,11e3,-18e3],file:"A34"},"A4-3":{name:"A4-3",position:[5500,16e3,-8900],file:"A18"},"A4-4":{name:"A4-4",position:[-5500,16e3,-9e3],file:"A17"},"A4-5":{name:"A4-5",position:[-5500,12e3,-17e3],file:"A23"},"A4-6":{name:"A4-6",position:[-13e3,13e3,-17500],file:"A37"},"A5-1":{name:"A5-1",position:[10500,17e3,1e3],file:"A19"},"A5-2":{name:"A5-2",position:[7500,17e3,1e4],file:"A21"},"A5-3":{name:"A5-3",position:[500,34e3,1e3],file:"A24"},"A5-4":{name:"A5-4",position:[-7500,17e3,1e4],file:"A20"},"A5-5":{name:"A5-5",position:[-12e3,17e3,1e3],file:"A16"},"A6-1":{name:"A6-1",position:[37e3,16e3,-1e4],file:"A35"},"A6-2":{name:"A6-2",position:[29500,14e3,-1e4],file:"A25"},"A6-3":{name:"A6-3",position:[29500,14e3,-17e3],file:"A28"},"A6-4":{name:"A6-4",position:[22500,11500,-9500],file:"A26"},"A6-5":{name:"A6-5",position:[22500,14e3,-17e3],file:"A27"},"A7-1":{name:"A7-1",position:[37500,12500,100],file:"A32"},"A7-2":{name:"A7-2",position:[37500,12500,9e3],file:"A31"},"A7-3":{name:"A7-3",position:[29500,12500,9e3],file:"A33"},"A7-4":{name:"A7-4",position:[29500,12500,100],file:"A40"},"A7-5":{name:"A7-5",position:[23e3,12500,9e3],file:"A29"},"A7-6":{name:"A7-6",position:[22500,12500,100],file:"A30"},"A8-1":{name:"A8-1",position:[37500,17e3,27500],file:"A38"},B0:{name:"B0",file:"B0"},B1:{name:"B1",file:"B1"},B2:{name:"B2",file:"B2"},B3:{name:"B3",file:"B3"},B4:{name:"B4",file:"B4"}},this.Flags={},this.objects=[],this.handleResize=function(){o.opts.width=o.container.clientWidth,o.opts.height=o.container.clientHeight,o.camera.aspect=o.opts.width/o.opts.height,o.camera.updateProjectionMatrix(),o.renderer.setSize(o.opts.width,o.opts.height)},this.container=t,this.clickHandle=i,this.opts={cameraAngle:45,cameraPosition:[0,77534,-101173],height:t.clientHeight,lightColor:14540253,lightIntensity:.5,lightPosition:[1e5,1e5,1e5],maxDistance:3e5,minDistance:5e4,modelPosition:[-2e4,160,-1771],modelScale:1,sceneBg:"/models/dark-bg.png",width:t.clientWidth},this.scene=new d.Scene,this.camera=new d.PerspectiveCamera(this.opts.cameraAngle,this.opts.width/this.opts.height,1,2*this.opts.maxDistance),(n=this.camera.position).set.apply(n,(0,l.default)(this.opts.cameraPosition)),this.scene.add(this.camera),this.renderer=new d.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.opts.width,this.opts.height),this.container.appendChild(this.renderer.domElement),this.composer=new f.EffectComposer(this.renderer);var r=new f.OutlineEffect(this.scene,this.camera,{blendFunction:f.BlendFunction.SCREEN,blur:!1,edgeStrength:2.5,pulseSpeed:0,visibleEdgeColor:16777215,xRay:!0});this.composer.addPass(new f.RenderPass(this.scene,this.camera));var u=new f.EffectPass(this.camera,r);u.renderToScreen=!0,this.composer.addPass(u),this.effect=r;var p=new d.AmbientLight("0xcccccc",1);this.scene.add(p);var m=new c.OrbitControls(this.camera,this.renderer.domElement);m.maxPolarAngle=.48*Math.PI,m.minDistance=this.opts.minDistance,m.maxDistance=this.opts.maxDistance;var g=new d.SpotLight(this.opts.lightColor,this.opts.lightIntensity);(a=g.position).set.apply(a,(0,l.default)(this.opts.lightPosition)),this.camera.add(g),this.scene.background=(new d.TextureLoader).load(this.opts.sceneBg),this.interaction=new h.Interaction(this.renderer,this.scene,this.camera),window.addEventListener("resize",this.handleResize,!1),this.start(),this.initialization()}return(0,o.default)(e,[{key:"start",value:function(){this.frameId||(this.frameId=window.requestAnimationFrame(this.animate.bind(this)))}},{key:"stop",value:function(){window.cancelAnimationFrame(this.frameId)}},{key:"animate",value:function(){this.composer.render(),this.frameId=window.requestAnimationFrame(this.animate.bind(this))}},{key:"initialization",value:function(){var e=this,t=Object.keys(this.data);t.forEach(function(t){e.loadObject(e.data[t])})}},{key:"Destory",value:function(){this.stop(),window.removeEventListener("resize",this.handleResize),this.container.removeChild(this.renderer.domElement)}},{key:"loadObject",value:function(e){var t=this;(new u.MTLLoader).load("/models/".concat(e.file,".mtl"),function(i){i.preload();var n=new r.OBJLoader;n.setMaterials(i),n.load("/models/".concat(e.file,".obj"),function(i){i.position.x=t.opts.modelPosition[0]*t.opts.modelScale,i.position.y=t.opts.modelPosition[1]*t.opts.modelScale,i.position.z=t.opts.modelPosition[2]*t.opts.modelScale,i.scale.set(t.opts.modelScale,t.opts.modelScale,t.opts.modelScale),t.addObjectFlag(e,i),t.scene.add(i)})})}},{key:"addObjectFlag",value:function(e,t){var i=this;t.on("mouseover",function(e){var t=!0,n=!1,a=void 0;try{for(var l,s=i.objects[Symbol.iterator]();!(t=(l=s.next()).done);t=!0){var o=l.value;o instanceof d.Mesh&&i.effect.deselectObject(o)}}catch(e){n=!0,a=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw a}}var c=e.data.target;if(c instanceof d.Group){var r=!0,u=!1,f=void 0;try{for(var h,p=c.children[Symbol.iterator]();!(r=(h=p.next()).done);r=!0){var m=h.value;m instanceof d.Mesh&&i.effect.selectObject(m)}}catch(e){u=!0,f=e}finally{try{r||null==p.return||p.return()}finally{if(u)throw f}}}else c instanceof d.Mesh&&i.effect.selectObject(c)}),t.on("mouseout",function(e){var t=e.data.target;if(t instanceof d.Group){var n=!0,a=!1,l=void 0;try{for(var s,o=t.children[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var c=s.value;c instanceof d.Mesh&&i.effect.deselectObject(c)}}catch(e){a=!0,l=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw l}}}else t instanceof d.Mesh&&i.effect.deselectObject(t)}),t.on("click",function(e){if(i.clickHandle){var t=e.target;Object.hasOwnProperty.call(t,"record_id")&&i.clickHandle(t.record_id)}});var n=t.children;this.Buildings[e.name]=t,Object.hasOwnProperty.call(this.AllBuildingSelectType,e.name)&&this.createSprite(e.name),this.objects=[].concat((0,l.default)(this.objects),(0,l.default)(n))}},{key:"createAllSprite",value:function(e){for(var t=0;t<e.length;t+=1)Object.hasOwnProperty.call(this.AllBuildingSelectType,e[t].name)?this.AllBuildingSelectType[e[t].name]!==e[t].select&&(this.AllBuildingSelectType[e[t].name]=e[t].select,this.createSprite(e[t].name)):(this.AllBuilding[e[t].name]=e[t],this.AllBuildingSelectType[e[t].name]=e[t].select,this.createSprite(e[t].name))}},{key:"createSprite",value:function(e){if(Object.hasOwnProperty.call(this.Buildings,e)){var t;Object.hasOwnProperty.call(this.Buildings[e],"record_id")||(this.Buildings[e].record_id=this.AllBuilding[e].record_id);var i=this.data[e],n=this.AllBuilding[e].flag_type,a=this.AllBuilding[e].flag_type_text,s=this.AllBuildingSelectType[e],o="/flags/".concat(n,".png");s||(o="/flags/0.png");var c=new Image,r=document.createElement("canvas");r.width=570,r.height=395;var u=new d.Texture(r),f=r.getContext("2d");f.fillStyle="#ffffff",f.font="100px Arial",f.lineWidth=25,f.textBaseline="middle",f.textAlign="center",c.onload=function(){f.drawImage(c,0,0,570,395),f.fillText(e,285,100),f.fillText(a,285,200),u.needsUpdate=!0};var h=new d.SpriteMaterial({map:u}),p=new d.Sprite(h);p.scale.set(3e3,2200,1),(t=p.position).set.apply(t,(0,l.default)(i.position)),c.src=o,Object.hasOwnProperty.call(this.Flags,e)&&this.Buildings[e].remove(this.Flags[e]),this.Buildings[e].add(p),this.Flags[e]=p}}}]),e}();t.Building3D=p},ygdr:function(e,t,i){e.exports={main:"web\\pages\\-building\\-building\\index-main",dataButton:"web\\pages\\-building\\-building\\index-dataButton",typeBox:"web\\pages\\-building\\-building\\index-typeBox","type-20":"web\\pages\\-building\\-building\\index-type-20","type-21":"web\\pages\\-building\\-building\\index-type-21","type-30":"web\\pages\\-building\\-building\\index-type-30","type-31":"web\\pages\\-building\\-building\\index-type-31","type-40":"web\\pages\\-building\\-building\\index-type-40","type-41":"web\\pages\\-building\\-building\\index-type-41","type-42":"web\\pages\\-building\\-building\\index-type-42",active:"web\\pages\\-building\\-building\\index-active",areaBox:"web\\pages\\-building\\-building\\index-areaBox",open:"web\\pages\\-building\\-building\\index-open",close:"web\\pages\\-building\\-building\\index-close",on:"web\\pages\\-building\\-building\\index-on",closeSider:"web\\pages\\-building\\-building\\index-closeSider",closeSiderLeft:"web\\pages\\-building\\-building\\index-closeSiderLeft",closeSiderRight:"web\\pages\\-building\\-building\\index-closeSiderRight",siderButton:"web\\pages\\-building\\-building\\index-siderButton",siderDrawer:"web\\pages\\-building\\-building\\index-siderDrawer",openSider:"web\\pages\\-building\\-building\\index-openSider",openSiderLeft:"web\\pages\\-building\\-building\\index-openSiderLeft",openSiderRight:"web\\pages\\-building\\-building\\index-openSiderRight",darkModal:"web\\pages\\-building\\-building\\index-darkModal"}}}]);